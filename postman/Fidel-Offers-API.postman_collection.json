{
  "info": {
    "name": "Fidel Offers API",
    "description": "A collection demonstrating the Offers API platform - connecting brands, locations, and offers.\n\n## Story Flow\n\n1. **Setup**: Create a brand (Starbucks)\n2. **Locations**: Add two store locations\n3. **Offers**: Create a cashback offer\n4. **Linking**: Link the offer to locations\n5. **Verification**: Check the relationships\n6. **Cleanup**: Unlink and delete\n\n## Key Features Demonstrated\n\n- **Case-insensitive uniqueness**: Brand and location names are unique regardless of casing\n- **Atomic transactions**: Linking offers to locations uses DynamoDB transactions\n- **Cursor-based pagination**: Efficient pagination for large datasets\n- **Cross-brand validation**: Offers can only be linked to locations of the same brand\n\n## Running the Collection\n\nRun requests in order - variables are automatically set from responses.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000"
    },
    {
      "key": "brandId",
      "value": ""
    },
    {
      "key": "location1Id",
      "value": ""
    },
    {
      "key": "location2Id",
      "value": ""
    },
    {
      "key": "offerId",
      "value": ""
    },
    {
      "key": "brand2Id",
      "value": ""
    },
    {
      "key": "location3Id",
      "value": ""
    }
  ],
  "item": [
    {
      "name": "1. Brands",
      "description": "Create and manage brands",
      "item": [
        {
          "name": "1.1 Create Brand (Starbucks)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const response = pm.response.json();",
                  "pm.collectionVariables.set('brandId', response.id);",
                  "",
                  "pm.test('Brand created successfully', function() {",
                  "    pm.response.to.have.status(201);",
                  "    pm.expect(response.name).to.eql('Starbucks');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Starbucks\",\n  \"description\": \"Global coffeehouse chain known for espresso drinks and cafÃ© atmosphere\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/brands",
              "host": ["{{baseUrl}}"],
              "path": ["brands"]
            },
            "description": "Create the Starbucks brand. The brand ID will be saved for subsequent requests."
          }
        },
        {
          "name": "1.2 Try Duplicate Brand (Should Fail)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Duplicate brand rejected (case-insensitive)', function() {",
                  "    pm.response.to.have.status(409);",
                  "    pm.expect(pm.response.json().message).to.include('already exists');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"STARBUCKS\",\n  \"description\": \"Attempting duplicate with different case\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/brands",
              "host": ["{{baseUrl}}"],
              "path": ["brands"]
            },
            "description": "Demonstrates case-insensitive uniqueness check. 'STARBUCKS' should fail because 'Starbucks' exists."
          }
        },
        {
          "name": "1.3 Get Brand",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Brand retrieved successfully', function() {",
                  "    pm.response.to.have.status(200);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.id).to.eql(pm.collectionVariables.get('brandId'));",
                  "});",
                  "",
                  "pm.test('nameLower is excluded from response', function() {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response).to.not.have.property('nameLower');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/brands/{{brandId}}",
              "host": ["{{baseUrl}}"],
              "path": ["brands", "{{brandId}}"]
            },
            "description": "Retrieve the created brand by ID. Note: nameLower is stored internally but excluded from API responses."
          }
        },
        {
          "name": "1.4 Create Second Brand (McDonald's)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const response = pm.response.json();",
                  "pm.collectionVariables.set('brand2Id', response.id);",
                  "",
                  "pm.test('Second brand created', function() {",
                  "    pm.response.to.have.status(201);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"McDonald's\",\n  \"description\": \"Fast food restaurant chain\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/brands",
              "host": ["{{baseUrl}}"],
              "path": ["brands"]
            },
            "description": "Create a second brand to demonstrate cross-brand validation later"
          }
        },
        {
          "name": "1.5 List All Brands",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Brands listed with pagination', function() {",
                  "    pm.response.to.have.status(200);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.items).to.be.an('array');",
                  "    pm.expect(response.items.length).to.be.at.least(2);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/brands?limit=10",
              "host": ["{{baseUrl}}"],
              "path": ["brands"],
              "query": [
                {
                  "key": "limit",
                  "value": "10"
                }
              ]
            },
            "description": "List all brands with pagination support"
          }
        }
      ]
    },
    {
      "name": "2. Locations",
      "description": "Create store locations for brands",
      "item": [
        {
          "name": "2.1 Create Location (Oxford Street)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const response = pm.response.json();",
                  "pm.collectionVariables.set('location1Id', response.id);",
                  "",
                  "pm.test('Location created with hasOffer=false', function() {",
                  "    pm.response.to.have.status(201);",
                  "    pm.expect(response.hasOffer).to.eql(false);",
                  "    pm.expect(response.brandId).to.eql(pm.collectionVariables.get('brandId'));",
                  "});",
                  "",
                  "pm.test('nameLower is excluded from response', function() {",
                  "    pm.expect(response).to.not.have.property('nameLower');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"brandId\": \"{{brandId}}\",\n  \"name\": \"Oxford Street\",\n  \"address\": \"128 Oxford Street, London W1D 1LT\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/locations",
              "host": ["{{baseUrl}}"],
              "path": ["locations"]
            },
            "description": "Create first Starbucks location. Note: hasOffer starts as false, nameLower is stored internally but excluded from response."
          }
        },
        {
          "name": "2.2 Create Location (Covent Garden)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const response = pm.response.json();",
                  "pm.collectionVariables.set('location2Id', response.id);",
                  "",
                  "pm.test('Second location created', function() {",
                  "    pm.response.to.have.status(201);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"brandId\": \"{{brandId}}\",\n  \"name\": \"Covent Garden\",\n  \"address\": \"14 James Street, Covent Garden, London WC2E 8BU\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/locations",
              "host": ["{{baseUrl}}"],
              "path": ["locations"]
            },
            "description": "Create second Starbucks location"
          }
        },
        {
          "name": "2.3 Try Duplicate Location Name (Should Fail - Case Insensitive)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Duplicate location name rejected (case-insensitive)', function() {",
                  "    pm.response.to.have.status(409);",
                  "    pm.expect(pm.response.json().message).to.include('already exists');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"brandId\": \"{{brandId}}\",\n  \"name\": \"OXFORD STREET\",\n  \"address\": \"Different address but same name with different casing\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/locations",
              "host": ["{{baseUrl}}"],
              "path": ["locations"]
            },
            "description": "Location names must be unique within a brand (case-insensitive). 'OXFORD STREET' should fail because 'Oxford Street' already exists."
          }
        },
        {
          "name": "2.4 Create McDonald's Location",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const response = pm.response.json();",
                  "pm.collectionVariables.set('location3Id', response.id);",
                  "",
                  "pm.test('McDonald\\'s location created', function() {",
                  "    pm.response.to.have.status(201);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"brandId\": \"{{brand2Id}}\",\n  \"name\": \"Leicester Square\",\n  \"address\": \"1 Leicester Square, London WC2H 7NA\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/locations",
              "host": ["{{baseUrl}}"],
              "path": ["locations"]
            },
            "description": "Create a McDonald's location for cross-brand validation demo"
          }
        },
        {
          "name": "2.5 List Locations (brandId required)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('List locations for brand', function() {",
                  "    pm.response.to.have.status(200);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.items.length).to.eql(2);",
                  "    response.items.forEach(loc => {",
                  "        pm.expect(loc.brandId).to.eql(pm.collectionVariables.get('brandId'));",
                  "        pm.expect(loc).to.not.have.property('nameLower');",
                  "    });",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/locations?brandId={{brandId}}",
              "host": ["{{baseUrl}}"],
              "path": ["locations"],
              "query": [
                {
                  "key": "brandId",
                  "value": "{{brandId}}"
                }
              ]
            },
            "description": "List locations for a specific brand. brandId is required - users can only view locations for their own brand."
          }
        },
        {
          "name": "2.6 List Locations Without brandId (Should Fail)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Request without brandId is rejected', function() {",
                  "    pm.response.to.have.status(400);",
                  "    pm.expect(pm.response.json().message).to.include('brandId');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/locations",
              "host": ["{{baseUrl}}"],
              "path": ["locations"]
            },
            "description": "Attempting to list locations without brandId should fail with 400 Bad Request"
          }
        }
      ]
    },
    {
      "name": "3. Offers",
      "description": "Create offers for brands",
      "item": [
        {
          "name": "3.1 Create Offer (5% Cashback)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const response = pm.response.json();",
                  "pm.collectionVariables.set('offerId', response.id);",
                  "",
                  "pm.test('Offer created with locationsTotal=0', function() {",
                  "    pm.response.to.have.status(201);",
                  "    pm.expect(response.locationsTotal).to.eql(0);",
                  "    pm.expect(response.name).to.eql('5% Cashback');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"brandId\": \"{{brandId}}\",\n  \"name\": \"5% Cashback\",\n  \"description\": \"Get 5% cashback on all purchases at participating Starbucks locations\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/offers",
              "host": ["{{baseUrl}}"],
              "path": ["offers"]
            },
            "description": "Create a cashback offer for Starbucks. Note: locationsTotal starts at 0"
          }
        },
        {
          "name": "3.2 Get Offer (Before Linking)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Offer has no linked locations yet', function() {",
                  "    pm.response.to.have.status(200);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.locationsTotal).to.eql(0);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/offers/{{offerId}}",
              "host": ["{{baseUrl}}"],
              "path": ["offers", "{{offerId}}"]
            },
            "description": "View offer before linking to any locations"
          }
        },
        {
          "name": "3.3 List Offers (brandId required)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('List offers for brand', function() {",
                  "    pm.response.to.have.status(200);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.items).to.be.an('array');",
                  "    pm.expect(response.items.length).to.be.at.least(1);",
                  "    response.items.forEach(offer => {",
                  "        pm.expect(offer.brandId).to.eql(pm.collectionVariables.get('brandId'));",
                  "    });",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/offers?brandId={{brandId}}",
              "host": ["{{baseUrl}}"],
              "path": ["offers"],
              "query": [
                {
                  "key": "brandId",
                  "value": "{{brandId}}"
                }
              ]
            },
            "description": "List offers for a specific brand. brandId is required - users can only view offers for their own brand."
          }
        },
        {
          "name": "3.4 List Offers Without brandId (Should Fail)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Request without brandId is rejected', function() {",
                  "    pm.response.to.have.status(400);",
                  "    pm.expect(pm.response.json().message).to.include('brandId');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/offers",
              "host": ["{{baseUrl}}"],
              "path": ["offers"]
            },
            "description": "Attempting to list offers without brandId should fail with 400 Bad Request"
          }
        }
      ]
    },
    {
      "name": "4. Link Offers to Locations",
      "description": "The core feature: connecting offers to locations with atomic transactions",
      "item": [
        {
          "name": "4.1 Link Offer to Oxford Street",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Offer linked - locationsTotal incremented', function() {",
                  "    pm.response.to.have.status(201);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.locationsTotal).to.eql(1);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "url": {
              "raw": "{{baseUrl}}/offers/{{offerId}}/locations/{{location1Id}}",
              "host": ["{{baseUrl}}"],
              "path": ["offers", "{{offerId}}", "locations", "{{location1Id}}"]
            },
            "description": "Link the 5% cashback offer to Oxford Street location.\n\nThis uses a DynamoDB transaction to atomically:\n- Add offerId to location's offerIds Set\n- Add locationId to offer's locationIds Set\n- Increment locationsTotal counter\n- Set location's hasOffer to true"
          }
        },
        {
          "name": "4.2 Verify Location Has Offer",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Location now hasOffer=true with offerIds', function() {",
                  "    pm.response.to.have.status(200);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.hasOffer).to.eql(true);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/locations/{{location1Id}}",
              "host": ["{{baseUrl}}"],
              "path": ["locations", "{{location1Id}}"]
            },
            "description": "Check that the location now shows hasOffer=true and contains the offerId"
          }
        },
        {
          "name": "4.3 Link Offer to Covent Garden",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Offer linked to second location', function() {",
                  "    pm.response.to.have.status(201);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.locationsTotal).to.eql(2);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "url": {
              "raw": "{{baseUrl}}/offers/{{offerId}}/locations/{{location2Id}}",
              "host": ["{{baseUrl}}"],
              "path": ["offers", "{{offerId}}", "locations", "{{location2Id}}"]
            },
            "description": "Link the same offer to a second location. locationsTotal should now be 2"
          }
        },
        {
          "name": "4.4 Try Duplicate Link (Should Fail)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Duplicate link rejected', function() {",
                  "    pm.response.to.have.status(409);",
                  "    pm.expect(pm.response.json().message).to.include('already linked');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "url": {
              "raw": "{{baseUrl}}/offers/{{offerId}}/locations/{{location1Id}}",
              "host": ["{{baseUrl}}"],
              "path": ["offers", "{{offerId}}", "locations", "{{location1Id}}"]
            },
            "description": "Attempting to link the same offer to the same location should fail"
          }
        },
        {
          "name": "4.5 Try Cross-Brand Link (Should Fail)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Cross-brand link rejected', function() {",
                  "    pm.response.to.have.status(409);",
                  "    pm.expect(pm.response.json().message).to.include('different brand');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "url": {
              "raw": "{{baseUrl}}/offers/{{offerId}}/locations/{{location3Id}}",
              "host": ["{{baseUrl}}"],
              "path": ["offers", "{{offerId}}", "locations", "{{location3Id}}"]
            },
            "description": "Attempting to link a Starbucks offer to a McDonald's location should fail.\n\nThis prevents companies from linking offers to competitor locations."
          }
        },
        {
          "name": "4.6 Get Offer (After Linking)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Offer shows 2 linked locations', function() {",
                  "    pm.response.to.have.status(200);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.locationsTotal).to.eql(2);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/offers/{{offerId}}",
              "host": ["{{baseUrl}}"],
              "path": ["offers", "{{offerId}}"]
            },
            "description": "View offer after linking - should show locationsTotal=2 and locationIds Set"
          }
        }
      ]
    },
    {
      "name": "5. Unlink and Cleanup",
      "description": "Demonstrate unlinking and data cleanup",
      "item": [
        {
          "name": "5.1 Unlink Offer from Oxford Street",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Offer unlinked - locationsTotal decremented', function() {",
                  "    pm.response.to.have.status(204);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "url": {
              "raw": "{{baseUrl}}/offers/{{offerId}}/locations/{{location1Id}}",
              "host": ["{{baseUrl}}"],
              "path": ["offers", "{{offerId}}", "locations", "{{location1Id}}"]
            },
            "description": "Unlink the offer from Oxford Street.\n\nThis atomically:\n- Removes offerId from location's offerIds Set\n- Removes locationId from offer's locationIds Set\n- Decrements locationsTotal counter\n- Updates hasOffer based on remaining offers"
          }
        },
        {
          "name": "5.2 Verify Location After Unlink",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Location hasOffer=false after unlink', function() {",
                  "    pm.response.to.have.status(200);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.hasOffer).to.eql(false);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/locations/{{location1Id}}",
              "host": ["{{baseUrl}}"],
              "path": ["locations", "{{location1Id}}"]
            },
            "description": "Oxford Street should now have hasOffer=false since it has no linked offers"
          }
        },
        {
          "name": "5.3 Verify Offer After Unlink",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Offer locationsTotal decremented to 1', function() {",
                  "    pm.response.to.have.status(200);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.locationsTotal).to.eql(1);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/offers/{{offerId}}",
              "host": ["{{baseUrl}}"],
              "path": ["offers", "{{offerId}}"]
            },
            "description": "Offer should now show locationsTotal=1"
          }
        },
        {
          "name": "5.4 Try Unlink Non-Existent Link (Should Fail)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Unlink non-existent link rejected', function() {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "url": {
              "raw": "{{baseUrl}}/offers/{{offerId}}/locations/{{location1Id}}",
              "host": ["{{baseUrl}}"],
              "path": ["offers", "{{offerId}}", "locations", "{{location1Id}}"]
            },
            "description": "Attempting to unlink an already unlinked offer should fail with 404"
          }
        }
      ]
    },
    {
      "name": "6. Pagination Demo",
      "description": "Demonstrate cursor-based pagination",
      "item": [
        {
          "name": "6.1 List Brands (Page 1)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('First page returned with cursor', function() {",
                  "    pm.response.to.have.status(200);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.items).to.be.an('array');",
                  "    if (response.nextCursor) {",
                  "        pm.collectionVariables.set('cursor', response.nextCursor);",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/brands?limit=1",
              "host": ["{{baseUrl}}"],
              "path": ["brands"],
              "query": [
                {
                  "key": "limit",
                  "value": "1"
                }
              ]
            },
            "description": "Get first page with limit=1 to demonstrate pagination"
          }
        },
        {
          "name": "6.2 List Brands (Page 2 with Cursor)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Second page returned using cursor', function() {",
                  "    pm.response.to.have.status(200);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.items).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/brands?limit=1&cursor={{cursor}}",
              "host": ["{{baseUrl}}"],
              "path": ["brands"],
              "query": [
                {
                  "key": "limit",
                  "value": "1"
                },
                {
                  "key": "cursor",
                  "value": "{{cursor}}"
                }
              ]
            },
            "description": "Get second page using the cursor from previous request"
          }
        }
      ]
    }
  ]
}
